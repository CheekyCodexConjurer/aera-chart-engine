name: CI

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"
      - name: Install
        run: npm ci
      - name: Typecheck
        run: npm run check
      - name: Contract tests
        run: npm run test:contracts
      - name: Harness smoke
        run: npm run test:ui:smoke
      - name: Replay harness
        run: npm run test:replay
      - name: PineScript parity
        run: npm run test:pinescript:parity
      - name: Bench baseline
        run: npm run bench:baseline
      - name: Bench interaction
        run: npm run bench:interaction
      - name: Bench gate
        run: npm run bench:gate
